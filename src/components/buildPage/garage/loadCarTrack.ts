import { PageListener } from '../pageListener';
import { DataStorage } from '../../dataStorage';
import { GaragePage } from './pageGarage';
import { EngineStatus} from '../../enums'
import { ICarData } from '../../interface';

export class CarTrack {
    static garage_page_listener: PageListener= new PageListener();
    static flag_color: string = '#f1f0ff';

static avtomobile_svg_tamplate(color: string): string {
    return `<svg class="car_svg" viewBox="0 0 1280.000000 640.000000"
preserveAspectRatio="xMidYMid meet">
<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"
fill="${color}" stroke="none">
<path d="M3525 5341 c-72 -18 -79 -28 -90 -121 -4 -30 -11 -62 -16 -71 -4 -9
-97 -51 -206 -94 -774 -304 -1348 -540 -1603 -661 -163 -77 -222 -91 -421
-104 -85 -5 -170 -14 -189 -20 -101 -32 -362 -58 -620 -63 l-115 -2 -47 -80
c-47 -78 -47 -80 -29 -100 34 -36 35 -77 5 -177 -30 -99 -34 -178 -19 -370 5
-67 4 -88 -6 -88 -29 0 -83 -56 -110 -114 -50 -106 -74 -343 -48 -467 13 -58
13 -62 3 -159 -5 -54 16 -238 28 -244 2 -1 29 -20 61 -41 73 -49 123 -103 132
-143 17 -79 167 -155 355 -181 104 -15 969 -97 1087 -104 l32 -2 5 160 c7 230
50 394 146 559 281 479 917 673 1405 429 316 -159 530 -424 598 -742 22 -106
29 -365 13 -519 l-8 -82 3002 0 c2855 0 3002 1 2995 18 -33 87 -56 325 -45
461 28 320 177 567 459 759 399 273 847 282 1243 24 239 -157 397 -392 460
-687 18 -84 15 -341 -5 -430 -8 -38 -14 -71 -12 -73 7 -8 386 20 478 34 180
28 253 65 304 152 24 41 28 57 28 127 -1 44 -9 117 -20 163 -18 79 -18 88 -2
190 31 199 40 306 41 497 1 176 -1 195 -23 260 -46 135 -103 190 -283 274
-222 104 -633 220 -1168 330 -523 108 -1524 210 -2054 211 l-229 0 -236 139
c-813 477 -1593 884 -1852 966 -498 157 -1598 195 -2892 100 l-188 -14 -47 30
c-92 58 -223 89 -297 70z m1912 -311 c13 -45 58 -305 88 -515 33 -226 74 -539
71 -542 -7 -7 -1672 40 -2054 58 -357 16 -464 56 -573 215 -62 91 -87 225 -59
326 12 40 56 74 192 148 369 198 799 289 1618 340 246 15 290 16 510 16 l194
-1 13 -45z m649 10 c383 -36 717 -86 934 -139 210 -52 451 -163 720 -332 141
-88 379 -259 380 -271 0 -5 -14 -8 -32 -8 -48 0 -114 -37 -140 -78 -24 -39
-30 -113 -15 -189 l9 -43 -904 0 -904 0 -176 540 -175 540 47 0 c25 0 141 -9
256 -20z"/>
<path d="M2617 3125 c-431 -82 -774 -440 -838 -875 -17 -117 -7 -292 24 -410
113 -436 497 -751 947 -777 507 -29 959 313 1076 813 28 117 26 348 -4 467
-94 378 -383 670 -760 768 -105 27 -336 34 -445 14z m378 -310 c84 -21 209
-85 280 -142 116 -94 210 -242 251 -393 23 -87 24 -260 0 -355 -58 -237 -242
-439 -473 -519 -531 -186 -1074 277 -969 828 30 152 94 274 206 386 111 110
237 178 385 206 84 16 235 11 320 -11z"/>
<path d="M2918 2568 c2 -90 7 -167 12 -172 17 -17 108 58 201 166 l51 57 -48
31 c-52 33 -131 65 -185 75 l-34 6 3 -163z"/>
<path d="M2591 2700 c-62 -22 -167 -82 -164 -94 3 -13 237 -216 249 -216 7 0
15 7 18 16 8 20 8 127 -1 232 -7 95 -8 96 -102 62z"/>
<path d="M3209 2355 c-57 -64 -105 -123 -107 -131 -6 -25 46 -35 157 -29 58 3
121 8 139 11 33 5 34 6 27 42 -7 44 -64 167 -92 201 l-19 24 -105 -118z"/>
<path d="M2260 2409 c-31 -44 -68 -133 -77 -186 l-6 -33 155 0 c165 0 201 9
181 44 -13 24 -204 216 -214 216 -5 0 -22 -18 -39 -41z"/>
<path d="M2786 2354 c-36 -35 0 -87 44 -64 26 14 26 56 1 70 -25 13 -27 13
-45 -6z"/>
<path d="M2751 2186 c-57 -32 -68 -111 -22 -157 43 -42 101 -43 143 -1 42 42
41 100 -1 143 -33 32 -78 38 -120 15z"/>
<path d="M2560 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20
-54 2z"/>
<path d="M3002 2124 c-27 -19 -28 -36 -3 -58 25 -23 61 -6 61 29 0 33 -30 49
-58 29z"/>
<path d="M2245 1993 c-77 -6 -76 -5 -59 -65 16 -55 61 -146 92 -186 l18 -23
103 122 c57 67 104 129 105 138 1 14 -14 16 -104 17 -58 0 -127 -1 -155 -3z"/>
<path d="M3165 1981 c-44 -4 -61 -10 -63 -22 -3 -16 210 -229 228 -229 22 0
86 141 105 228 l7 32 -109 -2 c-59 -1 -135 -4 -168 -7z"/>
<path d="M2776 1914 c-19 -18 -19 -20 -6 -45 6 -11 21 -19 35 -19 20 0 45 24
45 44 0 10 -32 36 -45 36 -7 0 -21 -7 -29 -16z"/>
<path d="M2589 1743 c-86 -90 -139 -151 -139 -162 0 -25 179 -101 236 -101
l27 0 -7 143 c-9 166 -13 187 -35 187 -9 0 -46 -30 -82 -67z"/>
<path d="M2936 1801 c-6 -10 -24 -168 -29 -258 -3 -60 -2 -63 19 -63 79 0 262
68 248 92 -5 7 -53 64 -108 126 -93 105 -117 124 -130 103z"/>
<path d="M10723 3125 c-318 -58 -597 -266 -743 -555 -223 -441 -98 -996 289
-1288 112 -84 188 -125 311 -166 274 -91 545 -70 802 61 552 282 735 983 392
1500 -225 339 -651 521 -1051 448z m385 -315 c348 -98 579 -443 532 -796 -67
-508 -596 -796 -1055 -574 -239 116 -396 352 -412 620 -20 335 192 640 516
745 122 40 289 42 419 5z"/>
<path d="M11017 2568 c3 -90 9 -167 14 -172 13 -14 53 18 155 122 l95 97 -23
18 c-50 40 -189 97 -235 97 -10 0 -11 -33 -6 -162z"/>
<path d="M10705 2706 c-50 -16 -133 -58 -163 -82 l-23 -19 121 -107 c67 -60
128 -108 135 -108 23 0 27 39 20 186 -8 162 -4 157 -90 130z"/>
<path d="M11307 2354 c-59 -65 -107 -126 -107 -136 0 -11 11 -18 38 -22 44 -7
278 7 289 17 15 16 -51 183 -94 236 l-19 24 -107 -119z"/>
<path d="M10362 2413 c-39 -62 -70 -134 -78 -184 l-7 -39 152 0 c86 0 161 5
172 10 17 10 18 13 5 38 -8 15 -59 71 -114 125 l-99 99 -31 -49z"/>
<path d="M10888 2359 c-24 -14 -23 -56 2 -69 44 -23 80 29 44 64 -18 19 -23
19 -46 5z"/>
<path d="M10851 2187 c-49 -29 -66 -101 -35 -146 9 -13 32 -29 50 -37 29 -12
39 -12 68 0 99 41 85 180 -19 192 -24 3 -50 -1 -64 -9z"/>
<path d="M10660 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20
-54 2z"/>
<path d="M11096 2124 c-9 -8 -16 -22 -16 -29 0 -13 26 -45 36 -45 20 0 44 25
44 45 0 14 -8 29 -19 35 -25 13 -27 13 -45 -6z"/>
<path d="M10335 1991 c-60 -6 -60 -6 -57 -36 9 -69 104 -248 122 -229 57 61
210 250 207 258 -4 12 -176 17 -272 7z"/>
<path d="M11267 1983 c-68 -5 -79 -19 -47 -60 23 -31 200 -193 210 -193 3 0
20 24 37 53 29 48 52 111 67 180 l6 27 -107 -2 c-60 -1 -134 -3 -166 -5z"/>
<path d="M10870 1910 c-16 -31 4 -62 38 -58 21 2 28 9 30 32 5 45 -47 65 -68
26z"/>
<path d="M10651 1703 c-56 -59 -101 -113 -101 -120 0 -28 172 -103 237 -103
l26 0 -7 123 c-10 179 -15 207 -36 207 -10 0 -63 -48 -119 -107z"/>
<path d="M11035 1801 c-7 -12 -23 -144 -29 -243 -4 -77 -4 -78 19 -78 45 0
130 22 193 51 l64 29 -19 23 c-65 82 -198 227 -209 227 -7 0 -15 -4 -19 -9z"/>
</g>
</svg>`;
}
static flag_svg_tamplate(color: string): string {
    return `<svg viewBox="0 0 1280.000000 1136.000000"
preserveAspectRatio="xMidYMid meet">
<g transform="translate(0.000000,1136.000000) scale(0.100000,-0.100000)"
fill="${color}" stroke="none">
<path d="M5805 11350 c-233 -24 -496 -100 -710 -205 -367 -181 -673 -455
-1415 -1270 -544 -597 -875 -908 -1195 -1120 -382 -255 -778 -369 -1165 -336
-328 28 -648 116 -1010 279 -241 108 -310 131 -310 103 0 -42 629 -1428 2108
-4645 l409 -890 154 -82 c526 -282 754 -333 1429 -321 326 6 361 12 571 98
509 209 806 455 1579 1309 456 503 732 777 1008 997 327 263 642 419 972 485
95 18 148 22 300 22 211 0 349 -17 559 -70 267 -66 447 -136 731 -280 l166
-84 199 -432 c109 -238 317 -692 463 -1008 1442 -3138 1767 -3838 1794 -3867
12 -12 30 -25 40 -29 34 -10 318 71 318 92 0 17 -546 1219 -1178 2589 -192
418 -522 1134 -732 1590 -210 457 -433 940 -495 1075 -98 214 -293 634 -975
2105 -87 187 -344 743 -573 1235 -608 1311 -1141 2449 -1165 2487 -6 10 -23
10 -72 2 -148 -23 -250 -74 -250 -126 0 -24 -3 -25 -37 -21 -21 3 -114 38
-206 77 -93 39 -213 87 -267 106 -128 44 -356 100 -490 120 -128 19 -433 27
-555 15z m430 -65 c493 -85 908 -229 1062 -370 109 -99 170 -203 356 -611 184
-403 198 -444 145 -429 -13 4 -81 36 -153 71 -302 148 -731 249 -1102 261
l-192 6 -147 326 c-156 346 -270 612 -298 699 -27 82 -22 86 87 79 50 -3 160
-18 242 -32z m-1543 -552 c47 -56 170 -301 383 -763 60 -129 110 -237 112
-239 1 -2 22 9 45 24 374 248 829 444 1030 445 53 0 59 -2 82 -33 55 -72 359
-724 425 -912 48 -135 49 -133 -94 -171 -348 -91 -506 -160 -807 -353 -148
-95 -170 -103 -192 -69 -9 14 -84 173 -167 354 -190 415 -315 674 -326 674
-15 0 -120 -85 -222 -180 -56 -52 -195 -194 -309 -315 -252 -266 -391 -405
-408 -405 -7 0 -22 15 -33 33 -46 75 -350 737 -400 870 -12 32 -21 81 -21 111
0 48 5 60 44 113 143 189 785 833 832 833 6 0 18 -8 26 -17z m2520 -1619 c302
-42 648 -140 918 -261 80 -36 166 -74 192 -85 l46 -20 162 -351 c166 -360 302
-663 315 -705 9 -31 10 -31 -225 68 -389 164 -615 221 -1045 261 -121 12 -221
22 -221 23 -5 4 -257 553 -324 706 -72 161 -140 330 -140 346 0 3 15 11 33 19
43 19 151 19 289 -1z m-4388 -332 c14 -27 93 -197 176 -378 200 -435 282 -604
290 -604 4 0 26 13 50 29 90 60 260 224 515 496 144 154 289 304 321 334 54
50 59 52 72 35 21 -28 77 -142 202 -409 143 -305 262 -543 287 -574 l20 -24
48 44 c26 24 141 143 254 263 221 236 429 433 554 527 43 33 82 59 86 59 9 0
49 -82 201 -410 136 -295 257 -545 290 -598 l20 -33 33 17 c17 9 88 53 157 98
279 180 502 272 814 336 54 11 106 20 115 20 19 0 70 -100 266 -525 134 -291
195 -445 202 -510 7 -71 -16 -90 -126 -99 -176 -14 -483 -145 -781 -331 -123
-77 -173 -105 -188 -105 -10 0 -113 220 -349 744 -79 176 -145 322 -148 324
-9 10 -205 -158 -336 -288 -74 -74 -183 -193 -241 -265 -108 -134 -337 -365
-361 -365 -19 0 -101 151 -219 403 -143 308 -281 587 -294 598 -20 17 -119
-76 -392 -369 -324 -347 -533 -545 -560 -528 -11 7 -167 332 -345 721 -138
302 -143 310 -173 313 -23 2 -65 -18 -189 -93 -88 -54 -204 -119 -258 -147
-203 -101 -452 -190 -572 -204 -82 -9 -99 -19 -91 -55 8 -44 93 -249 214 -519
123 -275 202 -477 202 -514 0 -40 -32 -49 -155 -48 -278 3 -849 152 -1133 296
-118 60 -145 86 -218 208 -158 266 -408 785 -438 912 -7 28 -7 28 31 21 21 -3
132 -44 248 -90 382 -153 641 -215 997 -240 110 -8 163 -2 172 21 11 29 -91
270 -339 802 -64 139 -116 255 -114 257 2 2 95 26 206 54 302 76 390 109 563
216 192 118 373 225 381 225 5 0 20 -22 33 -48z m5556 -1897 c210 -33 467
-107 708 -204 149 -60 242 -111 277 -153 55 -65 444 -889 462 -978 l5 -30 -38
14 c-22 8 -104 41 -183 75 -167 71 -317 121 -485 161 -189 46 -314 62 -549 69
l-218 6 -234 510 c-129 280 -235 515 -235 521 0 26 56 34 220 30 91 -2 212
-12 270 -21z m-4536 -317 c34 -63 238 -505 376 -818 40 -91 74 -167 76 -169 7
-8 182 148 305 272 73 72 247 255 386 405 140 149 256 272 259 272 7 0 92
-176 258 -534 185 -397 248 -526 257 -526 3 0 112 114 242 253 312 335 516
530 655 626 65 45 54 63 303 -484 125 -275 228 -505 228 -510 1 -6 -91 -95
-203 -198 -112 -103 -271 -258 -353 -344 -292 -311 -371 -387 -386 -375 -22
18 -171 316 -332 662 -80 173 -150 319 -154 323 -5 5 -137 -131 -294 -301
-422 -457 -608 -625 -655 -595 -23 14 -95 153 -278 538 -171 359 -231 475
-245 475 -5 0 -92 -51 -192 -114 -284 -177 -391 -226 -660 -302 -187 -53 -267
-82 -267 -95 0 -16 73 -183 245 -559 184 -402 227 -501 221 -507 -12 -12 -159
-14 -281 -4 -348 30 -570 93 -1040 296 -99 42 -185 82 -191 89 -11 10 -94 187
-327 696 -123 271 -168 373 -163 377 2 3 80 -27 173 -65 429 -179 599 -232
858 -268 123 -17 437 -25 451 -11 10 10 -10 57 -221 522 -101 220 -196 433
-213 472 l-31 73 27 14 c15 8 70 23 122 34 250 54 518 170 770 332 122 78 183
109 217 110 17 0 30 -15 57 -62z m1008 -2185 c19 -43 128 -279 242 -524 113
-245 206 -451 206 -456 0 -9 -197 -133 -370 -233 -189 -110 -469 -223 -617
-250 -144 -26 -198 27 -335 324 -84 182 -241 545 -274 632 -13 35 -21 70 -18
78 7 18 56 36 100 36 157 0 553 169 849 363 88 58 165 106 171 106 6 1 26 -34
46 -76z"/>
</g>
</svg>`;
}
static addNewTrack(id: number, name: string, carColor: string, flafColor: string): string {
    return `<div id="track_${id}" class="car_track"  status="${EngineStatus.Stop}">
    <div class="track_config">
    <button class="btn select_car" name="select_car">Select Car</button>
    <button class="btn remove_car" name="delete_car">Remove Car</button>
    <p class="car_info">${name}</p>
</div>
<div class="track_active">
    <div class="engine_panel">
        <button class="btn start_engine" name="start_engine">Engine</button>
        <button class="btn start_car" name="stop_car" disabled="disabled">Stop</button>
    </div>
    <div class="track_road"> ${this.avtomobile_svg_tamplate(carColor)}
        <div class="finish"> ${this.flag_svg_tamplate(flafColor)}
        </div>
    </div>
</div>
<hr>
</div>`;
}

static loadCarTrack(): void{
    GaragePage.paginatiotCounter();
    if (PageListener.CAR_TRACK) PageListener.CAR_TRACK.innerHTML = '';
    if (DataStorage.data_cars_from_server) {
        if (PageListener.RACE_AREA){
            PageListener.RACE_AREA.innerHTML = `<p class="cars_counter">Cars in the Garage = ${DataStorage.data_cars_from_server.size}</p>
                                                      <p class="page_number">Page #${1}</p>
                                                      <div class="race_place pagin_page_${0}"></div>`
            for(let i = 1; i < GaragePage.page_pagination_counter; i++){
                PageListener.RACE_AREA.innerHTML +=
                `<div class="race_place pagin_page_${i} inactive_track"></div>`;
            }
        }
            this.garage_page_listener.readPage();
            let carCount: number = 0;
            let iterArray: ICarData[] = Array.from(DataStorage.data_cars_from_server.values());
            for(let j = 0; j < GaragePage.page_pagination_counter; j++){
                let counter: number = 0;
                let TRACK: HTMLElement | null = document.querySelector(`.pagin_page_${j}`);
                for (let i: number = carCount; i < iterArray.length; i++) {
                    if(TRACK) TRACK.innerHTML += this.addNewTrack(
                        iterArray[i].id,
                        iterArray[i].name,
                        iterArray[i].color,
                        this.flag_color
                    );
                    carCount = i;
                    counter++;
                    if((counter === GaragePage.car_in_page_pagination)){
                        carCount++;
                        break;
                    };
            }
            };
        }
}
}
